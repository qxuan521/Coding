# 主题图鉴需求配置生成工具
### 基本需求描述

* 基本定义，物品信息对应表（.csv格式文件，内容为物品的ID与名字的对应关系）、初版输入表（.xls格式文件，内容为各种物品相关的兑换信息,内容存在未填写列需要填写）、完整版输入表（.xls格式文件，内容为各种物品相关的兑换信息，是初版输入表按照原有配置文件以及物品信息对应表填写后的结果)、配置文件（.xml格式，内容为根据完整版输入表按照特定格式生成的配置文件）。
* 流程描述，产品会根据活动等需要填写兑换系统物品相关信息的excel表格文件，策划会根据产品的表格文件编写xml配置文件，根据配置文件提供信息（兑换所需的碎片个数，是否有初次兑换优惠等等）完成游戏内物品兑换功能，由于工作流程重复且很容易出现人为失误，所以开发本工具完成初版输入表的填写，以及配置文件的生成，工具由炫舞1策划使用。
* 功能概述，工具完成三种功能：
  1. 完整版输入表填写以及新配置文件生成功能，根据输入到工具的物品信息对应表，初版输入表以及原配置文件生成一个完整版输入表，根据生成完整版输入表和原配置文件生成新的配置文件。完整版输入表和新配置文件的输出形式为另存为形式，即创建新的文件。
  2. 查询修改配置文件，修改特定字段实现更改物品普通兑换，不可兑换，首次兑换优惠的状态。根据输入ID列表文件（.xls格式文件，内容是需要查询显示的子系列ID的列表），查询配置文件的配置并显示。使用者通过可视化操作修改物品兑换的状态，工具根据对应状态修改配置文件。不会输出新的文件。
  3. 根据配置文件生成物品兑换信息表格，根据输入的子系列以及母系列的ID列表文件（.xls格式，内容是子系列的ID以及子系列的母系列的ID列表），输出新的信息（包含道具ID,名称，兑换所需系列碎片，首次兑换优惠所需碎片，等列）文件，文件会采用另存为的形式生成一个新的文件。

### 文件介绍

* 初版输入表

  初版输入表，为信息不完整的表格，缺少“系列套装配置”页签中的“子系列”、“兑换所需系列碎片”、“首次兑换优惠所需碎片”、“系列套装部件分数(y)”、“系列套装部件产出途径文本预设及系列碎片产出文本”页签中的“系列碎片获取途径提示”、“产出途径描述”，需要依据物品信息对应表和配置表填写为完整版，如下所示：

  ![初版表格](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\初版_1.png)

  ![初版2](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\初版_2.png)

* 完整输入表

  为根据初版输入表参照物品信息对应表和配置表按照一定规则填写后的表格文件。

  ![完整1](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\完整版_1.png)

  ![完整2](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\完整版_2.png)

* 配置文件

  依据完整输入表信息生成的文件，游戏内兑换功能读取相关配置使用。内容如下所示：

  ![配置文件截取1](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\配置文件截取_1.png)

  ![配置文件截取2](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\配置文件截取_2.png)

  

### 完整版输入表填写以及配置文件生成

初版输入表，为信息不完整的表格，缺少“系列套装配置”页签中的“子系列”、“兑换所需系列碎片”、“首次兑换优惠所需碎片”、“系列套装部件分数(y)”、“系列套装部件产出途径文本预设及系列碎片产出文本”页签中的“系列碎片获取途径提示”、“产出途径描述”，需要依据物品信息对应表和配置表填写为完整版，填写不覆盖初版输入表采用另存为的方式生成。新配置文件则根据新生成的完整输入表以及原配置文件，按照下述规则生成新的配置文件，同样采用另存为的方式生成新的文件不会对原配置文件进行修改。（图示如文件介绍所示）

##### 完整输入表填写规则

“系列套装配置”页签

1.子系列，读取母系列id，在clothset_handbook_config.xml中该母系列最后一个子id的基础上,顺延一个新的子系列id填入，例如母系列为400000，配置中最后一个子id为400008，则新的子id为400009

2.道具名称，读取国际化路径下的物品信息对应表文件，根据初版需求表中所给的道具ID，分别生成对应的男女道具名称。

3.兑换所需系列碎片，读取市场参考价，按照公式“市场参考价*0.75”得出“兑换所需系列碎片”,“兑换所需系列碎片”为整数（四舍五入）。

4.首次兑换优惠所需碎片，读取市场参考价，按照公式“市场参考价*0.6”得出“首次兑换优惠所需碎片”，“首次兑换优惠所需碎片”为整数（四舍五入）

5.系列套装部件分数(y)，读取市场参考价，按照公式“市场参考价*0.1”得出“系列套装部件分数(y)”， “系列套装部件分数(y)”为整数（四舍五入）

“系列套装部件产出途径文本预设及系列碎片产出文本”页签

1.系列碎片获取途径提示,读取clothset_handbook_config.xml中<PieceObtainText\>字段最后一个字段中的数字,在这个数字的基础上顺延一个新数字 ,“碎片获取途径” + 新数字填入表格中。

![填写图1](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\填写辅助_1.png)

2.产出途径描述，读取clothset_handbook_config.xml中<ClothsetObtainText\>字段最后一个字段中的数字,在这个数字的基础上顺延一个新数字填入表格中。

![辅助图2](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\填写辅助_2.png)

##### 新配置文件生成规则

读取完整版主题图鉴需求xls文档中--“系列套装部件产出途径文本预设及系列碎片产出文本”页签

1.系列碎片获得途径提示，在clothset_handbook_config.xml文件中的<PieceObtainText\>字段末尾处生成对应的字段， 配置中的context="X"，X对应表格中的文本文字，配置中的\<!--X--\>，X对应表格中碎片获取途径后的数字。

错误处理及检查

在生成以上字段之前，需要检测在\<PieceObtainText>中是否有重复的碎片获取途径数字，即\<!--X-->中的X是否重复, 若重复则生成检错txt文档（error.txt），文档中列出重复的数字。

输出结果图示，

![配置文件1](E:\需求分析\2019-02-12_主题图鉴需求配置生成工具\配置文件填写辅助1.png)



2.产出途径描述，在clothset_handbook_config.xml文件中的\<ClothsetObtainText>字段末尾处生成对应的字段，u 配置中的obtain_id="X"，X对应表格中的数字，配置中的context="XXXX"，X对应表格中的文本文字。

错误处理及检查

在生成以上字段之前，需要检测在\<ClothsetObtainText>字段中是否有重复的部件获取途径数字，即obtain_id="X"中的X是否重复，若重复则生成检错txt文档（error.txt），文档中列出重复的数字。



### 查询修改配置文件

### 根据配置文件生成物品兑换信息表

