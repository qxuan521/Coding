# 国际化名称和ID自动生成工具需求分析
## 基本需求描述：

* 策划会拿到运维提供的奖励物品表格文件并且需要按照标准的物品名与id的对应关系填写表格，并交付三方，为了避免人为失误，以及提高填写工作效率。需要开发一个能够自动完成填写，以及检查功能的工具。
* 定义：标准表为检查以及填写功能的标准源，一般格式为.csv。工作表为需要被填写或是被检查的表格，一般格式为.csv/.xls。
* 工具需要输入标准表格路径（用来读取比对数据的标准表，格式为.csv）、工作表（需要被填写或被检查的表格，格式为.csv/.xls），操作结束后需要将操作表按照另存为流程输出另一个文件。
* 需求能够将标准文件所在未见家选择的路径，进行保持操作（下一次打开工具 标准文件路径预填、预读）。
* 基础功能
  * 填写功能：根据工作表中原有信息将工作表补全，填写为双向填写,即根据物品填写id，或根据id填写物品。
  * 检验功能：对工作表中数据进行检查，检查功能在哪找标准数据表数据只提供单纯的检查严格按照规则以及数据源进行。
## 操作流程

![图3](E:\需求分析\2019-1-23_配置需求检查工具\Active.png)

## 标准表、工作表相关

* 标准表约束c

  标准表为.csv文件，对于不存在于标准表的数据都认为是有误的（比如少导入一个标准表）。所有的表中的通前缀下ID唯一（str_res_dress_name\_111111是唯一的），不存在相同数据。标准表格Id列存在字符串前缀需要确定前缀来获取想要的数据，不过前缀无法确定规则，并且不希望人为填写前缀，另外去除字符串后所留id数字存在名字与描述同ID的情况无法获取获取准去数据，所以本次程序支持标准表格为：level_inventory_dress.csv、level_inventory_item.csv、level_inventory_medal.csv，对应前缀为："str_res_dress_name\_"、"str_res_item_name\_"、"str_res_medal_name\_"。
* 标准读入处理

  标准表采取运行时自动预读，中途不会无故对数据标准表数据进行重新读入，如果有更改标准表数据并且希望应用到工具中需要重新启动程序。标准表读入根据前缀（"str_res_dress_name\_"、"str_res_item_name\_"、"str_res_medal_name\_"。）筛选并处数据：第一列符合前缀规则的行，获得去除前缀后的ID、获得对应的中文名字，建立映射关系。
* 工作表约束

  需要是.xls 、.csv或.xlsx文件，列名【男物品】【男ID】【女物品】【女ID】 表中至少包含两列且按男女成对出现。（【男物品】【男ID】必须同时存在或【女物品】【女ID】同时存在）。列的顺序、个数和位置不是固定的需要对表头进行预读。
* 标准表，工作表相关错误处理
  * 如果运行程序没有指定标准表目录或指定目录下存在但不满3个表，信息区输出  “缺少 xxxx表数据！ ”（xxxx为表名，缺少几个显示几次）。
  * 如果标准表中出去男女通用物品以外，有可能会存在ID名不同物品名相同的情况，在标准表读入时不做检查，如果在对工作表的操作用使用到了这种情况的元素则对工作表的当前单元格标黄,并且在信息区输出“xxx行xxx列 标准表中存在同名不同ID数据” 。
  * 如果工作表中不存在（【男物品】【男ID】【女物品】【女ID】）列或 男物品与男ID 或女物品与女ID，没有成对出现，则直接停止操作并在信息区输出“ 工作表 缺少列”。

## 保持路径文件格式：

![文件格式图](E:\需求分析\2019-1-23_配置需求检查工具\fileformat.png)

## 填写功能：
* 根据工作表中原有信息将工作表补全，填写为双向填写,即根据物品填写id，或根据id填写物品。

* 填写规则及错误处理

    根据工作表中名字对标准表数据进行查找，

    * 根据名字填写ID：

      如果所查名字在标准数据中不存在，则信息区输出  “xxx行xxx列 xxx 不存在”，并且标黄；

      如果所查名字存在，则获取对应ID并检查ID性别（因为名字无法区分性别，规则后文详述），此时有可能会存在一个名字对应多个ID的情况，如果超过两个则有可能是重名物品，则信息区输出所有对应ID “物品对应ID过多无法确定，ID： “xxxxxx”、[“xxxxxxx”].... ”，并对当前单元格进行标黄；

      如果所对应ID数为两个，并且第二位为0 和 1，其他位完全相同，则选择符合性别的ID并进行填写；

      如果性别符合则填写，如果性别不符合，则信息区输出 “xxx行xxx列 xxx性别错误 ”，并进行标黄。

    * 根据ID填写名字：

      如果所查ID在标准数据中不存在，则信息区输出 “xxx行xxx列xxx不存在 ”，并进行标黄；

      如果所查ID存在，则先对当前ID进行性别验证（规则后文详述），如果性别符合，则填写对应名字；

      如果性别不符合，则信息区输出“xxx行xxx列 xxxx性别错误 ”，并进行标黄；

    * 性别验证规则（同名字性别验证，因为名字是先映射到ID在进行验证）

    ​	如果是服装类id（首位是1/7）或挂饰类id（首位是4）则验证第二位 性别是否符合（1为女、0为男）。

    ​	如果验证数据不符合规则 则在信息区输出 “ xxxxx性别错误”，并且进行标黄。

## 检查功能：

* 对工作表中数据进行检查，检查功能在哪找标准数据表数据只提供单纯的检查严格按照规则以及数据源进行。

* 检查应包括 数据完整性检查、数据正确性检查。数据完整性检查，会将所有映射关系没有填写完整的数据进行标注（如 物品名没有填写、id没有填写）。数据正确性检查，根据一定规则进行数据正确性验证。

* 检查规则及错误处理

  * 基本检查：

    ​	由于有可能会存在重名物品（一个物品名对应多个ID的情况），所以验证以ID为标识进行验证。

    * 如果所查ID在标准数据中不存在，则信息区输出  “xxx行xxx列 xxx 不存在”，并且标黄；

    * 如果所查ID存在，则映射当前ID对应名字检查是否一致，如果不一致则信息区输出 “xxx行xxx列xxx，ID与名字映射失败”，并标黄；

    * 如果上述检查成功，则对当前ID性别进行检查（规则下述），如果性别错误，若当前物品存在正确性别ID则在信息区输出 “xxx行xxx列 xxx性别错误，正确为：xxxx”，如果不存在对应正确性别的ID则输出 “xxx行xxx列 xxx性别错误 ”。并对错误单元格进行标黄

    * 注意：

      ​	相同物品如果存在两个性别的ID，应该是除了第二位 0/1的区别以外其他位完全相同，这样的ID别看做同物品的男女ID。

      ​	如果检查时出现一个物品对应多个ID（两个或两个以上）并且ID不是同物品的男女ID，会对当前填写ID验证是否

  - 性别验证规则（同名字性别验证，因为名字是先映射到ID在进行验证）

  ​	如果是服装类id（首位是1/7）或挂饰类id（首位是4）则验证第二位 性别是否符合（1为女、0为男）。

  ​	如果验证数据不符合规则 则在信息区输出 “ xxxxx性别错误”，并且进行标黄。
## UI 原型

![图2](/UIPrototype.png)









